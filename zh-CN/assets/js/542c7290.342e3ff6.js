"use strict";(self.webpackChunkconflux_docs=self.webpackChunkconflux_docs||[]).push([[7449],{3905:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>m});var n=o(67294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var l=n.createContext({}),c=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):s(s({},t),e)),o},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),h=c(o),u=a,m=h["".concat(l,".").concat(u)]||h[u]||d[u]||r;return o?n.createElement(m,s(s({ref:t},p),{},{components:o})):n.createElement(m,s({ref:t},p))}));function m(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,s=new Array(r);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[h]="string"==typeof e?e:a,s[1]=i;for(var c=2;c<r;c++)s[c]=o[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,o)}u.displayName="MDXCreateElement"},20407:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var n=o(87462),a=(o(67294),o(3905));const r={sidebar_position:3,title:"Sponsorship Mechanism",displayed_sidebar:"coreSidebar"},s=void 0,i={unversionedId:"core/core-space-basics/sponsor-mechanism",id:"core/core-space-basics/sponsor-mechanism",title:"Sponsorship Mechanism",description:"Conflux Core Space implements a sponsorship mechanism to subsidize the usage of smart contracts. Thus, a new account with zero balance is able to call smart contracts as long as the execution is sponsored (usually by the operator of Dapps). This mechanism is designed to reduce the barrier of entry for new users.",source:"@site/docs/core/core-space-basics/sponsor-mechanism.md",sourceDirName:"core/core-space-basics",slug:"/core/core-space-basics/sponsor-mechanism",permalink:"/zh-CN/docs/core/core-space-basics/sponsor-mechanism",draft:!1,editUrl:"https://crowdin.com/project/conflux/zh-CN",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Sponsorship Mechanism",displayed_sidebar:"coreSidebar"},sidebar:"coreSidebar",previous:{title:"Storage Collateral",permalink:"/zh-CN/docs/core/core-space-basics/storage"},next:{title:"Accounts",permalink:"/zh-CN/docs/core/core-space-basics/accounts"}},l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"How to Sponsor a Contract",id:"how-to-sponsor-a-contract",level:2},{value:"Gas Sponsorship",id:"gas-sponsorship",level:3},{value:"Storage Sponsorship",id:"storage-sponsorship",level:3},{value:"Whitelist",id:"whitelist",level:3},{value:"FAQs",id:"faqs",level:2},{value:"How to check if a contract is sponsored?",id:"how-to-check-if-a-contract-is-sponsored",level:3},{value:"I sponsored a contract, but the transaction still failed. Why?",id:"i-sponsored-a-contract-but-the-transaction-still-failed-why",level:3},{value:"Why the sponsor balance is small than what I sponsored?",id:"why-the-sponsor-balance-is-small-than-what-i-sponsored",level:3}],p={toc:c},h="wrapper";function d(e){let{components:t,...o}=e;return(0,a.kt)(h,(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Conflux Core Space implements a sponsorship mechanism to subsidize the usage of smart contracts. Thus, a new account with zero balance is able to call smart contracts as long as the execution is sponsored (usually by the operator of Dapps). This mechanism is designed to reduce the barrier of entry for new users.\nPave the way for the mass adoption of blockchain."),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"In the blockchain world, it is very common to pay transaction fees when sending transactions. Ethereum has gas fees, and Conflux Core Space has not only gas fees but also storage collateral fees. Typically, these costs are paid by the sender of the transaction. However, new users in the blockchain world may not understand these concepts and may not have the tokens to pay these fees, creating a barrier to entry into the blockchain world. To lower this barrier, Conflux Core Space has introduced a sponsorship mechanism."),(0,a.kt)("p",null,"The sponsorship mechanism allows a contract to be sponsored. Once sponsored, the transaction fees incurred when the contract is called are paid by the sponsor, meaning that users do not need to worry about or pay these fees. The sponsor can be the owner of the contract or someone else. Imagine a ",(0,a.kt)("inlineCode",{parentName:"p"},"USDT")," token deployed on Core Space that can be transferred by anyone without any fees \u2013 this is incredibly user-friendly for new users."),(0,a.kt)("p",null,"Both the gas and storage collateral for a transaction can be sponsored, and they support two different sponsors. For example, the gas fees for a contract could be sponsored by Sponsor A, while the storage collateral is sponsored by Sponsor B."),(0,a.kt)("p",null,"Note that only contracts can be sponsored; the sponsorship mechanism does not apply to regular accounts. This means that for standard CFX transfer transactions, the gas fees need to be paid by the sender."),(0,a.kt)("h2",{id:"how-to-sponsor-a-contract"},"How to Sponsor a Contract"),(0,a.kt)("p",null,"To sponsor a contract, the sponsor needs to call ",(0,a.kt)("a",{parentName:"p",href:"./internal-contracts/sponsor-whitelist-control"},"SponsorWhitelistControl")," internal contract. It also record the sponsorship information of smart contracts"),(0,a.kt)("h3",{id:"gas-sponsorship"},"Gas Sponsorship"),(0,a.kt)("p",null,"To sponsor the gas fees of a contract, you call the ",(0,a.kt)("inlineCode",{parentName:"p"},"setSponsorForGas")," method of the ",(0,a.kt)("inlineCode",{parentName:"p"},"SponsorWhitelistControl"),". This method has two parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"contractAddr"),": The address of the contract to be sponsored."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"upperBound"),": The upper limit for gas fee sponsorship per transaction, measured in Drip, where 1 CFX = 10^18 Drip. If the gas fee (calculated as gasPrice * gasLimit) for a transaction interacting with the same contract exceeds this limit, it cannot be sponsored.")),(0,a.kt)("p",null,"Currently, the minimum gas fee on the Conflux Core network is 1 GDrip, which is 10^9 Drip. Typically, the gas for a transaction ranges from tens of thousands to several hundred thousand. Therefore, it's common to set the ",(0,a.kt)("inlineCode",{parentName:"p"},"upperBound")," to around 5 million GDrip. This can be adjusted according to specific needs in special cases."),(0,a.kt)("p",null,"Additionally, the total amount of gas to be sponsored needs to be set through the ",(0,a.kt)("inlineCode",{parentName:"p"},"value")," field of the transaction. This means that when calling this method, a CFX transfer must be made simultaneously. Moreover, each sponsorship amount should be sufficient to cover the gas fees for at least ",(0,a.kt)("inlineCode",{parentName:"p"},"1000 transactions")," (1000 ",(0,a.kt)("em",{parentName:"p"}," upperBound). For instance, if the upperBound is set to 1 million GDrip, then each sponsorship amount should be at least 1000 ")," 1 million GDrip."),(0,a.kt)("p",null,"For example, to sponsor Contract A with a gas limit of 1 million GDrip and a total sponsorship amount of 100 CFX, you would initiate a transaction calling ",(0,a.kt)("inlineCode",{parentName:"p"},"setSponsorForGas(A, 10^15)"),", with the transaction's value field set to 100 CFX."),(0,a.kt)("p",null,"This built-in contract also provides several methods for querying sponsorship information of a contract:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"getSponsoredGasFeeUpperBound"),": To query the upper limit of gas fee sponsorship for a contract."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"getSponsoredBalanceForGas"),": To query the remaining balance of gas fee sponsorship for a contract."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"getSponsorForGas"),": To query the sponsor of the gas fee for a contract.")),(0,a.kt)("p",null,"If a sponsor already exists for the contract when calling ",(0,a.kt)("inlineCode",{parentName:"p"},"setSponsorForGas"),", and if the new sponsor is the same as the current one, the sponsorship balance for the contract will be topped up. If the new sponsor is different, a replacement will occur. In this case, the amount of sponsorship needs to be greater than ",(0,a.kt)("inlineCode",{parentName:"p"},"currentSponsorBalance + 1000 * upperBound"),". The balance of the previous sponsor will be refunded, and the remaining amount will serve as the sponsorship balance after the change of sponsor."),(0,a.kt)("h3",{id:"storage-sponsorship"},"Storage Sponsorship"),(0,a.kt)("p",null,"To sponsor the storage collateral of a contract, you can call the ",(0,a.kt)("inlineCode",{parentName:"p"},"setSponsorForCollateral")," method of the ",(0,a.kt)("inlineCode",{parentName:"p"},"SponsorWhitelistControl"),". This method has only one parameter:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"contractAddr"),": The address of the contract to be sponsored.")),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"total amount")," of sponsorship is also specified through the ",(0,a.kt)("inlineCode",{parentName:"p"},"value")," of the transaction. According to CIP-107, a portion of the sponsorship (currently 50%) is converted into storage points after the sponsorship is set. Both storage points and the storage sponsorship balance can be used to pay for the contract's storage collateral fees, with the storage sponsorship balance being used first."),(0,a.kt)("p",null,"This built-in contract also provides several methods for querying sponsorship information of a contract:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"getSponsoredBalanceForCollateral"),": To query the remaining balance of storage collateral sponsorship for a contract."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"getSponsorForCollateral"),": To query the sponsor of the storage for a contract."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"getAvailableStoragePoints"),": To query the remaining balance of storage points sponsored for a contract.")),(0,a.kt)("p",null,"Similarly, if a sponsor already exists for the contract when calling ",(0,a.kt)("inlineCode",{parentName:"p"},"setSponsorForCollateral"),", and if the new sponsor is the same as the current one, the sponsorship balance for the contract will be topped up. If the new sponsor is different, a replacement will occur. In this case, the amount of sponsorship needs to be greater than ",(0,a.kt)("inlineCode",{parentName:"p"},"currentSponsorBalance")," + ",(0,a.kt)("inlineCode",{parentName:"p"},"currentCollateral"),". The balance and collateral of the previous sponsor will be refunded, and the remaining amount will serve as the sponsorship balance after the change of sponsor (a portion of which will be converted into storage points)."),(0,a.kt)("h3",{id:"whitelist"},"Whitelist"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"SponsorWhitelistControl")," also maintains a whitelist for each sponsored contract. Only addresses on this whitelist can enjoy the benefits of the sponsorship when interacting with the contract; otherwise, the transaction fees must be paid by the sender. This whitelist can be modified using the ",(0,a.kt)("inlineCode",{parentName:"p"},"addPrivilegeByAdmin")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"removePrivilegeByAdmin")," methods of ",(0,a.kt)("inlineCode",{parentName:"p"},"SponsorWhitelistControl"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function addPrivilegeByAdmin(address contractAddr, address[] memory addresses) public;\nfunction removePrivilegeByAdmin(address contractAddr, address[] memory addresses) public;\n")),(0,a.kt)("p",null,"These two methods can only be called by the administrator of the contract, who by default is the creator of the contract. For more details, you can refer to the ",(0,a.kt)("a",{parentName:"p",href:"/zh-CN/docs/core/core-space-basics/internal-contracts/admin"},(0,a.kt)("inlineCode",{parentName:"a"},"AdminControl")," built-in contract"),"."),(0,a.kt)("p",null,"The zero address ",(0,a.kt)("strong",{parentName:"p"},"0x0000000000000000000000000000000000000000")," is a special address. When added to the whitelist, it allows all addresses to enjoy the sponsorship benefits."),(0,a.kt)("p",null,"The current status of the whitelist can be queried using the following methods:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// return true if the user is whitelisted for the contract\nfunction isWhitelisted(address contractAddr, address user) public view returns (bool)\n// return true if all users are whitelisted for the contract\nfunction isAllWhitelisted(address contractAddr) public view returns (bool)\n")),(0,a.kt)("h2",{id:"faqs"},"FAQs"),(0,a.kt)("h3",{id:"how-to-check-if-a-contract-is-sponsored"},"How to check if a contract is sponsored?"),(0,a.kt)("p",null,"You can call ",(0,a.kt)("inlineCode",{parentName:"p"},"SponsorWhitelistControl"),"'s query methods to check the sponsorship information of a contract. For example, ",(0,a.kt)("inlineCode",{parentName:"p"},"getSponsorForGas")," to check the gas sponsor."),(0,a.kt)("p",null,"You can use ConfluxScan's ",(0,a.kt)("a",{parentName:"p",href:"https://confluxscan.io/address/cfx:aaejuaaaaaaaaaaaaaaaaaaaaaaaaaaaaegg2r16ar?tab=contract-viewer"},"Read and Write Contract page")," to call the query methods."),(0,a.kt)("h3",{id:"i-sponsored-a-contract-but-the-transaction-still-failed-why"},"I sponsored a contract, but the transaction still failed. Why?"),(0,a.kt)("p",null,"There are several reasons that may cause the transaction to fail:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Upperbound is too small."),(0,a.kt)("li",{parentName:"ol"},"The sponsor balance is not enough."),(0,a.kt)("li",{parentName:"ol"},"The whitelist is not set correctly.")),(0,a.kt)("h3",{id:"why-the-sponsor-balance-is-small-than-what-i-sponsored"},"Why the sponsor balance is small than what I sponsored?"),(0,a.kt)("p",null,"If sponsor replacement happens, the previous sponsor balance will be returned to the sponsor. The remaining balance will be used as the new sponsor balance."),(0,a.kt)("p",null,"And for the storage sponsorship, part of the sponsor balance will be converted to storage points."))}d.isMDXComponent=!0}}]);