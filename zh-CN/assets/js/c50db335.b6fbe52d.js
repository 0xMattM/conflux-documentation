"use strict";(self.webpackChunkconflux_docs=self.webpackChunkconflux_docs||[]).push([[7422],{22366:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>i});var s=o(85893),r=o(11151);const t={sidebar_position:2,title:"SponsorWhitelistControl",displayed_sidebar:"coreSidebar"},c=void 0,a={id:"core/core-space-basics/internal-contracts/sponsor-whitelist-control",title:"SponsorWhitelistControl",description:"Conflux\u5b9e\u73b0\u4e86\u8d5e\u52a9\u673a\u5236\uff0c\u6765\u8865\u8d34\u667a\u80fd\u5408\u7ea6\u7684\u4f7f\u7528\u3002 \u8fd9\u5141\u8bb8\u4f59\u989d\u4e3a\u96f6\u7684\u65b0\u8d26\u6237\u8c03\u7528\u667a\u80fd\u5408\u7ea6\uff0c\u524d\u63d0\u662f\u6267\u884c\u64cd\u4f5c\u5f97\u5230\u8d5e\u52a9\uff08\u901a\u5e38\u7531Dapp\u8fd0\u8425\u8005\u63d0\u4f9b\uff09\u3002 \u5185\u90e8\u7684 SponsorWhitelistControl \u5408\u7ea6\u8bb0\u5f55\u4e86\u667a\u80fd\u5408\u7ea6\u7684\u8d5e\u52a9\u4fe1\u606f\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/core/core-space-basics/internal-contracts/sponsor-whitelist-control.md",sourceDirName:"core/core-space-basics/internal-contracts",slug:"/core/core-space-basics/internal-contracts/sponsor-whitelist-control",permalink:"/zh-CN/docs/core/core-space-basics/internal-contracts/sponsor-whitelist-control",draft:!1,unlisted:!1,editUrl:"https://crowdin.com/project/conflux/zh-CN",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"SponsorWhitelistControl",displayed_sidebar:"coreSidebar"},sidebar:"coreSidebar",previous:{title:"AdminControl",permalink:"/zh-CN/docs/core/core-space-basics/internal-contracts/admin"},next:{title:"Staking",permalink:"/zh-CN/docs/core/core-space-basics/internal-contracts/staking"}},d={},i=[{value:"Interface",id:"interface",level:2},{value:"\u5982\u4f55\u8d5e\u52a9\u667a\u80fd\u5408\u7ea6",id:"\u5982\u4f55\u8d5e\u52a9\u667a\u80fd\u5408\u7ea6",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:3},{value:"Specification",id:"specification",level:2},{value:"\u5b58\u50a8\u70b9",id:"\u5b58\u50a8\u70b9",level:3},{value:"<code>setSponsorForGas</code> \u548c <code>setSponsorForCollateral</code> \u7684\u884c\u4e3a",id:"setsponsorforgas-\u548c-setsponsorforcollateral-\u7684\u884c\u4e3a",level:3},{value:"\u589e\u52a0\u8d5e\u52a9\u4f59\u989d",id:"\u589e\u52a0\u8d5e\u52a9\u4f59\u989d",level:4},{value:"\u8d5e\u52a9\u66ff\u6362",id:"\u8d5e\u52a9\u66ff\u6362",level:4},{value:"Gas Sponsor Replacement",id:"gas-sponsor-replacement",level:5},{value:"Collateral Sponsor Replacement",id:"collateral-sponsor-replacement",level:5},{value:"\u767d\u540d\u5355\u7ef4\u62a4",id:"\u767d\u540d\u5355\u7ef4\u62a4",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Conflux\u5b9e\u73b0\u4e86\u8d5e\u52a9\u673a\u5236\uff0c\u6765\u8865\u8d34\u667a\u80fd\u5408\u7ea6\u7684\u4f7f\u7528\u3002 \u8fd9\u5141\u8bb8\u4f59\u989d\u4e3a\u96f6\u7684\u65b0\u8d26\u6237\u8c03\u7528\u667a\u80fd\u5408\u7ea6\uff0c\u524d\u63d0\u662f\u6267\u884c\u64cd\u4f5c\u5f97\u5230\u8d5e\u52a9\uff08\u901a\u5e38\u7531Dapp\u8fd0\u8425\u8005\u63d0\u4f9b\uff09\u3002 \u5185\u90e8\u7684 ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," \u5408\u7ea6\u8bb0\u5f55\u4e86\u667a\u80fd\u5408\u7ea6\u7684\u8d5e\u52a9\u4fe1\u606f\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"interface",children:"Interface"}),"\n",(0,s.jsxs)(n.p,{children:["SponsorWhitelistControl's hex40 address is ",(0,s.jsx)(n.code,{children:"0x0888000000000000000000000000000000000001"}),", with interface:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"pragma solidity >=0.4.15;\n\ncontract SponsorWhitelistControl {\n    /*** Query Functions ***/\n    /**\n     * @dev get gas sponsor address of specific contract\n     * @param contractAddr The address of the sponsored contract\n     */\n    function getSponsorForGas(address contractAddr) public view returns (address) {}\n\n    /**\n     * @dev get current Sponsored Balance for gas\n     * @param contractAddr The address of the sponsored contract\n     */\n    function getSponsoredBalanceForGas(address contractAddr) public view returns (uint256) {}\n\n    /**\n     * @dev get current Sponsored Gas fee upper bound\n     * @param contractAddr The address of the sponsored contract\n     */\n    function getSponsoredGasFeeUpperBound(address contractAddr) public view returns (uint256) {}\n\n    /**\n     * @dev get collateral sponsor address\n     * @param contractAddr The address of the sponsored contract\n     */\n    function getSponsorForCollateral(address contractAddr) public view returns (address) {}\n\n    /**\n     * @dev get current Sponsored Balance for collateral\n     * @param contractAddr The address of the sponsored contract\n     */\n    function getSponsoredBalanceForCollateral(address contractAddr) public view returns (uint256) {}\n\n    /**\n     * @dev check if a user is in a contract's whitelist\n     * @param contractAddr The address of the sponsored contract\n     * @param user The address of contract user\n     */\n    function isWhitelisted(address contractAddr, address user) public view returns (bool) {}\n\n    /**\n     * @dev check if all users are in a contract's whitelist\n     * @param contractAddr The address of the sponsored contract\n     */\n    function isAllWhitelisted(address contractAddr) public view returns (bool) {}\n\n    /*** for contract admin only **/\n    /**\n     * @dev contract admin add user to whitelist\n     * @param contractAddr The address of the sponsored contract\n     * @param addresses The user address array\n     */\n    function addPrivilegeByAdmin(address contractAddr, address[] memory addresses) public {}\n\n    /**\n     * @dev contract admin remove user from whitelist\n     * @param contractAddr The address of the sponsored contract\n     * @param addresses The user address array\n     */\n    function removePrivilegeByAdmin(address contractAddr, address[] memory addresses) public {}\n\n    // ------------------------------------------------------------------------\n    // Someone will sponsor the gas cost for contract `contractAddr` with an\n    // `upper_bound` for a single transaction.\n    // ------------------------------------------------------------------------\n    function setSponsorForGas(address contractAddr, uint upperBound) public payable {}\n\n    // ------------------------------------------------------------------------\n    // Someone will sponsor the storage collateral for contract `contractAddr`.\n    // ------------------------------------------------------------------------\n    function setSponsorForCollateral(address contractAddr) public payable {}\n\n    // ------------------------------------------------------------------------\n    // Add commission privilege for address `user` to some contract.\n    // ------------------------------------------------------------------------\n    function addPrivilege(address[] memory) public {}\n\n    // ------------------------------------------------------------------------\n    // Remove commission privilege for address `user` from some contract.\n    // ------------------------------------------------------------------------\n    function removePrivilege(address[] memory) public {}\n\n    /**\n     * @dev get current available storage points for collateral (activated after CIP-118)\n     * @param contractAddr The address of the sponsored contract\n     */\n    function getAvailableStoragePoints(address contractAddr) public view returns (uint256) {}\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u5982\u4f55\u8d5e\u52a9\u667a\u80fd\u5408\u7ea6",children:"\u5982\u4f55\u8d5e\u52a9\u667a\u80fd\u5408\u7ea6"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," \u4e3a\u6bcf\u4e2a\u7528\u6237\u5efa\u7acb\u7684\u5408\u7ea6\u7ef4\u62a4\u4e00\u4e2a\u767d\u540d\u5355\uff0c\u5305\u542b\u6709\u8d44\u683c\u83b7\u5f97\u8865\u8d34\u7684\u8d26\u6237\u3002 \u9996\u5148\uff0c\u5e94\u8be5\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"addPrivilege(address[] memory)"})," \u6216 ",(0,s.jsx)(n.code,{children:"addPrivilegeByAdmin(address contractAddr, address[] memory addresses)"})," \u5c06\u5408\u683c\u8d26\u6237\u6dfb\u52a0\u5230\u767d\u540d\u5355\u4e2d\u3002 Specially, if a ",(0,s.jsx)(n.strong,{children:"zero address"})," is added to the whitelist, any account will become eligible for subsidy."]}),"\n",(0,s.jsxs)(n.p,{children:["There are two resources that can be sponsored: gas consumption and storage collateral. \u8fd9\u4e24\u79cd\u8d44\u6e90\u53ef\u4ee5\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"payable"})," \u63a5\u53e3 ",(0,s.jsx)(n.code,{children:"setSponsorForGas(address contractAddr, uint upperBound)"})," \u548c ",(0,s.jsx)(n.code,{children:"setSponsorForCollateral(address contractAddr)"})," \u5206\u522b\u8fdb\u884c\u8d5e\u52a9\u3002"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"upperBound"}),"\uff08\u5355\u4f4d\uff1aDrip\uff09\u8bbe\u7f6e\u4e86\u6bcf\u7b14\u4ea4\u6613\u7684\u8d5e\u52a9\u4e0a\u9650\u3002 \u4ea4\u6613\u53d1\u9001\u7684\u4ef7\u503c\u5e94\u4e0d\u4f4e\u4e8e1000 * ",(0,s.jsx)(n.code,{children:"upperBound"}),"\u3002"]})}),"\n",(0,s.jsx)(n.h3,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,s.jsx)(n.p,{children:"\u5047\u5b9a\u60a8\u6709\u4e00\u4e2a\u6d4b\u8bd5\u5408\u7ea6\u9700\u8981\u8d5e\u52a9\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'pragma solidity >=0.8.0;\n\nimport "https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/SponsorWhitelistControl.sol";\n\ncontract CommissionPrivilegeTest {\n    mapping(uint => uint) public ss;\n\n    function add(address account) public {\n        SponsorWhitelistControl cpc = SponsorWhitelistControl(0x0888000000000000000000000000000000000001);\n        address[] memory a = new address[](1);\n        a[0] = account;\n        cpc.addPrivilege(a);\n    }\n\n    function remove(address account) public {\n        SponsorWhitelistControl cpc = SponsorWhitelistControl(0x0888000000000000000000000000000000000001);\n        address[] memory a = new address[](1);\n        a[0] = account;\n        cpc.removePrivilege(a);\n    }\n\n    function par_add(uint start, uint end) public {\n        for (uint i = start; i < end; i++) {\n            ss[i] = 1;\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"The following javascript code shows how to deploy and sponsor the provided test contract."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'"use strict"\nconst { Conflux, Drip } = require("js-conflux-sdk")\n// you need to change the path to the compiled contract\nconst { abi, bytecode } = require("path/to/CommissionPrivilegeTest.json");\n\nasync function main() {\n  // your secret key to deploy contract\n  // testnet token can be claimed at https://faucet.confluxnetwork.org/\n  const PRIVATE_KEY = \'0x......\';\n  const cfx = new Conflux({\n    url: \'https://test.confluxrpc.com\',\n    // logger: console,\n    networkId: 1,\n  });\n  const account = cfx.wallet.addPrivateKey(PRIVATE_KEY); // create account instance\n  const randomAccount = cfx.wallet.addRandom() // a random account with no cfx\n  const testContract = cfx.Contract({\n    abi,\n    bytecode\n  })\n\n  const contract_addr = (await testContract.constructor().sendTransaction({\n    from: account.address\n  }).executed()).contractCreated\n  console.log(`contract deployed at ${contract_addr}`)\n\n  testContract.address = contract_addr\n  await testContract.add(randomAccount.address).sendTransaction({\n    from: account.address\n  }).executed()\n  console.log(`random address ${randomAccount.address} added to whitelist`)\n\n  const sponsor_contract = cfx.InternalContract(\'SponsorWhitelistControl\');\n\n  const upperBound = 10n**15n\n  const upperBoundCfx = Drip(upperBound).toCFX()\n  const gasSponsorVal = 10n**18n\n  const storageSponsorVal = 10n ** 18n\n  if( gasSponsorVal < upperBound * 1000n ) {\n    throw new Error(`gas sponsor value should be greater than 1000 * upperBound`)\n  }\n  await sponsor_contract.setSponsorForGas(contract_addr, upperBound).sendTransaction({\n    from: account,\n    value: gasSponsorVal\n  }).executed();\n  console.log(`Gas is sponsored with upper bound ${upperBound} Drip (${upperBoundCfx} CFX)`)\n  await sponsor_contract.setSponsorForCollateral(contract_addr).sendTransaction({\n    from: account,\n    value: storageSponsorVal\n  }).executed();\n  console.log("Storage collateral is sponsored")\n\n  const receipt = await testContract.par_add(1, 3).sendTransaction({\n    from: randomAccount.address\n  }).executed()\n  console.log(`${receipt.transactionHash} is sent`)\n  console.log(`gas and storage covered by sponsor: ${receipt.gasCoveredBySponsor && receipt.storageCoveredBySponsor}`)\n}\n\nmain().catch(\n  console.error\n)\n'})}),"\n",(0,s.jsx)(n.p,{children:"The example provided illustrates how to deploy and sponsor a test contract. The code is divided into five main sections:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Setting Up Conflux Instance and Accounts"}),"\n",(0,s.jsx)(n.li,{children:"Deploying the Smart Contract"}),"\n",(0,s.jsx)(n.li,{children:"Interacting with the Deployed Contract"}),"\n",(0,s.jsx)(n.li,{children:"Sponsoring Gas and Storage"}),"\n",(0,s.jsx)(n.li,{children:"Sending a Transaction whose Gas and Storage are Sponsored"}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Setting Up Conflux Instance and Accounts"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const PRIVATE_KEY = '0x......';\nconst cfx = new Conflux({\n  url: 'https://test.confluxrpc.com',\n  networkId: 1,\n});\nconst account = cfx.wallet.addPrivateKey(PRIVATE_KEY);\nconst randomAccount = cfx.wallet.addRandom();\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PRIVATE_KEY"}),": A placeholder for the private key of the user. This is essential for deploying contracts and sending transactions. ",(0,s.jsx)(n.strong,{children:"You need to replace this value with your own private key with enough CFX"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"account"}),": An account instance created using the provided private key. Will be used to deploy contract."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"randomAccount"}),": A new random account instance. This account doesn't have any CFX (Conflux's native currency) by default."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Deploying the Smart Contract"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const testContract = cfx.Contract({\n  abi,\n  bytecode\n});\nconst contract_addr = (await testContract.constructor().sendTransaction({\n  from: account.address\n}).executed()).contractCreated;\nconsole.log(`contract deployed at ${contract_addr}`);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"testContract"}),": A new contract instance is created using the ABI and bytecode."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Interacting with the Deployed Contract"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"testContract.address = contract_addr;\nawait testContract.add(randomAccount.address).sendTransaction({\n  from: account.address\n}).executed();\nconsole.log(`random address ${randomAccount.address} added to whitelist`);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The address of the deployed contract is set to the ",(0,s.jsx)(n.code,{children:"testContract"})," instance."]}),"\n",(0,s.jsx)(n.li,{children:"A transaction is sent to the contract to add the random account's address to a whitelist."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Sponsoring Gas and Storage"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const sponsor_contract = cfx.InternalContract('SponsorWhitelistControl');\nconst upperBound = 10n**15n;\nconst upperBoundCfx = Drip(upperbound).toCFX();\nconst gasSponsorVal = 10n**18n;\nconst storageSponsorVal = 10n ** 18n;\nif( gasSponsorVal < upperBound * 1000n ) {\n  throw new Error(`gas sponsor value should be greater than 1000 * upperBound`);\n}\nawait sponsor_contract.setSponsorForGas(contract_addr, upperBound).sendTransaction({\n  from: account,\n  value: gasSponsorVal\n}).executed();\nconsole.log(`Gas is sponsored with upper bound ${upperBound} Drip (${upperBoundCfx} CFX)`);\nawait sponsor_contract.setSponsorForCollateral(contract_addr).sendTransaction({\n  from: account,\n  value: storageSponsorVal\n}).executed();\nconsole.log(\"Storage collateral is sponsored\");\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The code sets an upper bound for gas sponsorship and calculates its equivalent in CFX. It makes sure if the gas sponsorship value is at least 1000 times the upper bound. If not, an error is thrown. (This is the requirement of the ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," interface)"]}),"\n",(0,s.jsx)(n.li,{children:"The code then sponsors gas and storage for the deployed contract. This means users interacting with the contract won't have to pay for gas or storage, as it's covered by the sponsor."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Sending a Transaction whose Gas and Storage are Sponsored"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const receipt = await testContract.par_add(1, 3).sendTransaction({\n  from: randomAccount.address\n}).executed();\nconsole.log(`${receipt.transactionHash} is sent`);\nconsole.log(`gas and storage covered by sponsor: ${receipt.gasCoveredBySponsor && receipt.storageCoveredBySponsor}`);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["A transaction is sent to the contract, calling the ",(0,s.jsx)(n.code,{children:"par_add"})," function with arguments ",(0,s.jsx)(n.code,{children:"1"})," and ",(0,s.jsx)(n.code,{children:"3"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Log the transaction's hash and whether its gas and storage were covered using the transaction receipt."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"specification",children:"Specification"}),"\n",(0,s.jsx)(n.p,{children:"Conflux keeps the following information for each user-established contract:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sponsor_for_gas"}),": this is the account that provides the subsidy for gas consumption, and can be accessed via ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," or ",(0,s.jsx)(n.code,{children:"getSponsorInfo"})," RPC;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sponsor_for_collateral"}),": this is the account that provides the subsidy for collateral for storage, and can be accessed via ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," or ",(0,s.jsx)(n.code,{children:"getSponsorInfo"})," RPC;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"}),": this is the balance of subsidy available for gas consumption, and can be accessed via ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," or ",(0,s.jsx)(n.code,{children:"getSponsorInfo"})," RPC;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sponsor_balance_for_collateral"}),": ",(0,s.jsx)(n.em,{children:"refundable"})," balance of subsidy available for collateral for storage, and can be accessed via ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," or ",(0,s.jsx)(n.code,{children:"getSponsorInfo"})," RPC;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"availableStoragePoints"}),": storage points available for storage collateral, and can be accessed via ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," or ",(0,s.jsx)(n.code,{children:"getSponsorInfo"})," RPC;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"usedStoragePoints"}),": storage points available for storage collateral, can be accessed via ",(0,s.jsx)(n.code,{children:"getSponsorInfo"})," RPC, can only be accessed via ",(0,s.jsx)(n.code,{children:"getSponsorInfo"})," RPC;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sponsor_limit_for_gas_fee"}),": this is the upper bound for the gas fee subsidy paid for every sponsored transaction, and can be accessed via ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," or ",(0,s.jsx)(n.code,{children:"getSponsorInfo"})," RPC;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"whitelist"}),": \u8fd9\u662f\u6709\u8d44\u683c\u83b7\u5f97\u8865\u8d34\u7684\u666e\u901a\u8d26\u6237\u5217\u8868\uff0c\u5176\u4e2d\u4e00\u4e2a\u7279\u6b8a\u7684\u5168\u96f6\u5730\u5740\u6307\u4ee3\u6240\u6709\u666e\u901a\u8d26\u6237\u3002 \u53ea\u6709\u5408\u7ea6\u672c\u8eab\u548c\u7ba1\u7406\u5458\u6709\u6743\u66f4\u6539\u8fd9\u4e2a\u5217\u8868\u3002 The elements of whitelist cannot be accessed directly, instead, ",(0,s.jsx)(n.code,{children:"isWhitelisted"})," interface of ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," can tell if an address is whitelisted."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There are two resources that can be sponsored: gas consumption and storage collateral."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:"For gas consumption"}),": If a transaction calls a contract with non-empty ",(0,s.jsx)(n.code,{children:"sponsor_for_gas"})," and the sender is in the ",(0,s.jsx)(n.code,{children:"whitelist"})," of the contract and the gas fee specified by the transaction is within the ",(0,s.jsx)(n.code,{children:"sponsor_limit_for_gas_fee"}),", the gas consumption of the transaction is paid from the ",(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"})," of the contract (if it is sufficient) rather than from the sender\u2019s balance. \u5426\u5219\uff0c\u53d1\u9001\u8005\u5e94\u8be5\u652f\u4ed8gas\u6d88\u8017\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:"For storage collateral"}),": If a transaction calls a contract with non-empty ",(0,s.jsx)(n.code,{children:"available_storage_points"})," or ",(0,s.jsx)(n.code,{children:"sponsor_for_collateral"})," and the sender is in the ",(0,s.jsx)(n.code,{children:"whitelist"})," of the contract, the collateral for storage incurred in the execution of the transaction is deducted from ",(0,s.jsx)(n.code,{children:"sponsor_for_collateral"}),"(with priority) or ",(0,s.jsx)(n.code,{children:"available_storage_points"})," of the contract, and the owner of those modified storage entries is set to the contract address accordingly. \u5426\u5219\uff0c\u53d1\u9001\u8005\u5e94\u8be5\u652f\u4ed8\u4ea4\u6613\u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u5b58\u50a8\u62b5\u62bc\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5f53\u6d88\u606f\u8c03\u7528\u53d1\u751f\u65f6\uff0cConflux\u4e0d\u4f1a\u91cd\u65b0\u68c0\u67e5\u8d5e\u52a9\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u666e\u901a\u5730\u5740 ",(0,s.jsx)(n.code,{children:"A"})," \u8c03\u7528\u5408\u7ea6 ",(0,s.jsx)(n.code,{children:"B"})," \uff0c\u5408\u7ea6 ",(0,s.jsx)(n.code,{children:"B"})," \u8c03\u7528\u5408\u7ea6",(0,s.jsx)(n.code,{children:"C"})," \uff0cConflux \u53ea\u4f1a\u68c0\u67e5\u5730\u5740 ",(0,s.jsx)(n.code,{children:"A"})," \u662f\u5426\u5f97\u5230\u5408\u7ea6 ",(0,s.jsx)(n.code,{children:"B"})," \u7684\u8d5e\u52a9\u3002 \u5982\u679c",(0,s.jsx)(n.code,{children:"A"}),"\u88ab\u8d5e\u52a9\uff0c",(0,s.jsx)(n.code,{children:"B"}),"\u5c06\u627f\u62c5\u4ea4\u6613\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709gas\u548c/\u6216\u5b58\u50a8\u62b5\u62bc\uff0c\u5305\u62ec\u4ece",(0,s.jsx)(n.code,{children:"B"}),"\u5230",(0,s.jsx)(n.code,{children:"C"}),"\u7684\u6d88\u606f\u8c03\u7528\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u53ea\u6709\u4e00\u4e2a\u4ea4\u6613\u53d1\u9001\u8005\u624d\u80fd\u88ab\u8d5e\u52a9\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5b58\u50a8\u70b9",children:"\u5b58\u50a8\u70b9"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/Conflux-Chain/CIPs/blob/master/CIPs/cip-107.md",children:"CIP-107"})," \u5f15\u5165\u4e86\u5b58\u50a8\u70b9\u7684\u6982\u5ff5\uff0c\u4ee5\u6539\u5584Conflux\u7684\u4ee3\u5e01\u7ecf\u6d4e\u3002"]}),"\n",(0,s.jsx)(n.p,{children:'\u5f53\u8d5e\u52a9\u8005\u4e3a\u5408\u7ea6\u589e\u52a0\u5b58\u50a8\u62b5\u62bc\u65f6\uff0c\u4e00\u90e8\u5206\u7684CFX\u4ee3\u5e01\u5c06\u88ab\u9500\u6bc1\uff0c\u5e76\u76f8\u5e94\u5730\u94f8\u9020\u51fa"\u5b58\u50a8\u70b9"\u3002 "\u5b58\u50a8\u70b9"\u4e0d\u80fd\u8f6c\u79fb\uff0c\u4e5f\u4e0d\u4f1a\u4ea7\u751f\u5b58\u50a8\u5229\u606f\u3002 \u4f46\u5b83\u53ef\u4ee5\u50cfCFX\u4ee3\u5e01\u4e00\u6837\u652f\u4ed8\u5b58\u50a8\u62b5\u62bc\u3002'}),"\n",(0,s.jsx)(n.p,{children:"\u5b58\u50a8\u70b9\u7cfb\u7edf\u65e8\u5728\u5bf9\u4ee3\u5e01\u7ecf\u6d4e\u4ea7\u751f\u6700\u5c0f\u5f71\u54cd\u3002 \u5408\u7ea6\u8d5e\u52a9\u8005\u4e3b\u8981\u5173\u5fc3\u652f\u6301\u5176\u4e1a\u52a1\u8fd0\u8425\u6240\u9700\u7684\u4ee3\u5e01\u6570\u91cf\uff0c\u800c\u901a\u5e38\u4e0d\u5173\u5fc3\u5b58\u50a8\u62b5\u62bc\u7684\u9000\u6b3e\u3002"}),"\n",(0,s.jsxs)(n.h3,{id:"setsponsorforgas-\u548c-setsponsorforcollateral-\u7684\u884c\u4e3a",children:[(0,s.jsx)(n.code,{children:"setSponsorForGas"})," \u548c ",(0,s.jsx)(n.code,{children:"setSponsorForCollateral"})," \u7684\u884c\u4e3a"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5f53\u5408\u7ea6\u521b\u5efa\u65f6\uff0c\u5176 ",(0,s.jsx)(n.code,{children:"sponsor_for_gas"})," \u548c ",(0,s.jsx)(n.code,{children:"sponsor_for_collateral"})," \u5c06\u7531\u96f6\u5730\u5740\u521d\u59cb\u5316\uff0c\u8d5e\u52a9\u4f59\u989d\u548c\u5b58\u50a8\u70b9\u5c06\u521d\u59cb\u5316\u4e3a0\u3002 \u901a\u8fc7\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"SponsorWhitelistControl"})," \u5408\u7ea6\u7684 ",(0,s.jsx)(n.code,{children:"setSponsorForGas"})," \u548c ",(0,s.jsx)(n.code,{children:"setSponsorForCollateral"})," \uff0c\u53ef\u4ee5\u66f4\u65b0gas\u548c\u62b5\u62bc\u7684\u8d5e\u52a9\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u800c\uff0c\u4e0a\u8ff0\u63a5\u53e3\u7684\u884c\u4e3a\u5728\u4e0d\u540c\u60c5\u51b5\u4e0b\u6709\u6240\u4e0d\u540c\u3002"}),"\n",(0,s.jsx)(n.h4,{id:"\u589e\u52a0\u8d5e\u52a9\u4f59\u989d",children:"\u589e\u52a0\u8d5e\u52a9\u4f59\u989d"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u8d5e\u52a9\u4ece\u672a\u8bbe\u7f6e\u8fc7\u6216\u5f53\u524d\u8d5e\u52a9\u8005\u5c31\u662f\u8be5\u8d26\u6237\u672c\u8eab\uff0c\u8d26\u6237\u53ef\u4ee5\u63d0\u4f9b\u8d5e\u52a9\u4f59\u989d\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8d5e\u52a9\u8005\u5e94\u4e0e\u51fd\u6570 ",(0,s.jsx)(n.code,{children:"setSponsorForGas(address contractAddr, uint upperBound)"})," \u6216 ",(0,s.jsx)(n.code,{children:"setSponsorForCollateral(address contractAddr)"})," \u8fdb\u884c\u4ea4\u4e92\u3002"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5bf9\u4e8e ",(0,s.jsx)(n.code,{children:"setSponsorForGas(address contractAddr, uint upperBound)"})," \uff0c\u5982\u679c\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff0c\u4ee5drip\u4e3a\u5355\u4f4d\u8ba1\u7b97\u7684\u8f6c\u79fb\u4ef7\u503c\u5c06\u88ab\u6dfb\u52a0\u5230 ",(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"})," \uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u65b0 ",(0,s.jsx)(n.code,{children:"upperBound"})," \u7684\u503c\u5e94\u4e0d\u4f4e\u4e8e\u65e7 ",(0,s.jsx)(n.code,{children:"upperBound"})," \uff0c\u9664\u975e\u5f53\u524d ",(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"})," \u8d1f\u62c5\u4e0d\u8d77\u65e7 ",(0,s.jsx)(n.code,{children:"sponsor_limit_for_gas_fee"})," \u3002 \u4f46\u5982\u679c\u8d5e\u52a9\u4ece\u672a\u8bbe\u7f6e\uff0c\u8fd9\u6761\u89c4\u5219\u5c06\u88ab\u5ffd\u7565\u3002"]}),"\n",(0,s.jsx)(n.li,{children:"\u6b64\u5916\uff0c\u8f6c\u79fb\u8d44\u91d1\u5e94\u4e0d\u4f4e\u4e8e\u65b0\u9650\u5236\u76841000\u500d\uff0c\u8fd9\u610f\u5473\u7740\u8d5e\u52a9\u81f3\u5c11\u5e94\u652f\u63011000\u6b21\u8c03\u7528\u3002"}),"\n",(0,s.jsxs)(n.li,{children:["\u4ee5drip\u4e3a\u5355\u4f4d\u8ba1\u7b97\u7684\u7684\u8f6c\u79fb\u4ef7\u503c\u5c06\u88ab\u6dfb\u52a0\u5230 ",(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"})," \u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5bf9\u4e8e ",(0,s.jsx)(n.code,{children:"setSponsorForCollateral(address contractAddr)"})," \uff0c\u6ca1\u6709\u989d\u5916\u8981\u6c42\u3002 \u63d0\u4f9b\u7684\u5269\u4f59CFX\u7684 ",(0,s.jsx)(n.code,{children:"p"})," \u6bd4\u4f8b\uff08\u5373p * tx.value\uff09\u5c06\u88ab\u70e7\u6bc1\u5e76\u8f6c\u6362\u4e3a storage_points \u3002 The rest (",(0,s.jsx)(n.code,{children:"(1-p) * tx.value"}),") will be added to ",(0,s.jsx)(n.code,{children:"sponsor_balance_for_collateral"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"\u8d5e\u52a9\u66ff\u6362",children:"\u8d5e\u52a9\u66ff\u6362"}),"\n",(0,s.jsx)(n.h5,{id:"gas-sponsor-replacement",children:"Gas Sponsor Replacement"}),"\n",(0,s.jsx)(n.p,{children:"To replace the gas sponsor of a contract, the new sponsor must meet specific conditions\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u8f6c\u79fb\u7684\u8d44\u91d1\u5e94\u8be5\u5927\u4e8e\u5408\u7ea6\u5f53\u524d\u7684",(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"}),"\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u65b0\u7684",(0,s.jsx)(n.code,{children:"sponsor_limit_for_gas_fee"}),"\uff08\u7531",(0,s.jsx)(n.code,{children:"upperBound"}),"\u53c2\u6570\u6307\u5b9a\uff09\u5e94\u8be5\u4e0d\u4f4e\u4e8e\u65e7\u8d5e\u52a9\u8005\u7684\u9650\u5236\uff0c\u9664\u975e\u65e7\u7684",(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"}),"\u4e0d\u80fd\u8d1f\u62c5\u65e7\u7684",(0,s.jsx)(n.code,{children:"sponsor_limit_for_gas_fee"}),"\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u8f6c\u79fb\u7684\u8d44\u91d1\u5e94\u8be5 >=\u65b0\u9650\u5236\u76841000\u500d\uff0c\u8fd9\u6837\u624d\u80fd\u8db3\u4ee5\u8865\u8d34\u81f3\u5c11",(0,s.jsx)(n.code,{children:"1000\u6b21"}),"\u8c03\u7528\u5408\u7ea6\u7684\u4ea4\u6613\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\uff0c\u5269\u4f59\u7684",(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"}),"\u5c06\u9000\u8fd8\u7ed9\u65e7\u7684",(0,s.jsx)(n.code,{children:"sponsor_for_gas"}),"\uff0c\u800c\u88ab\u8f6c\u79fb\u5230\u5185\u90e8\u5408\u7ea6\u7684\u8d44\u91d1\u5c06\u52a0\u5230\u5408\u7ea6\u7684",(0,s.jsx)(n.code,{children:"sponsor_balance_for_gas"}),"\u4e2d\u3002 \u7136\u540e\uff0c\u6839\u636e\u65b0\u8d5e\u52a9\u8005\u7684\u6307\u5b9a\uff0c\u66f4\u65b0",(0,s.jsx)(n.code,{children:"sponsor_for_gas"}),"\u548c",(0,s.jsx)(n.code,{children:"sponsor_limit_for_gas_fee"}),"\u3002 \u5426\u5219\uff0c\u5c06\u89e6\u53d1\u4e00\u4e2a\u5f02\u5e38\u3002"]}),"\n",(0,s.jsx)(n.h5,{id:"collateral-sponsor-replacement",children:"Collateral Sponsor Replacement"}),"\n",(0,s.jsx)(n.p,{children:"The replacement of collateral sponsorship is similar but more complex due to storage points. As a proportion of CFX is burnt, the new sponsor should transfer a fund more than the refundable CFX provided by the current sponsor for collateral of the contract, whereas,"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"refundable storage collateral = sponsor_balance_for_collateral + (collateral_for_storage - use_storage_points / 1024)"})}),"\n",(0,s.jsxs)(n.p,{children:["The origin sponsor will be refunded with the above CFX immediately after the sponsor replacement. The ",(0,s.jsx)(n.code,{children:"collateral_for_storage"})," refers to storage collateral already sponsored, accessible via ",(0,s.jsx)(n.code,{children:"cfx_getAccount"})," RPC with contract's address as parameter."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"p"})," proportion of the surplus CFX provided will be burnt and converted into storage_points, whereas,"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"surplus storage points\n= p * (surplus CFX provided) * 1024\n= p * (tx.value - previous refundable collateral) * 1024\n= p * (tx.value - (sponsor_balance_for_collateral + (collateral_for_storage - use_storage_points / 1024))) * 1024\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u767d\u540d\u5355\u7ef4\u62a4",children:"\u767d\u540d\u5355\u7ef4\u62a4"}),"\n",(0,s.jsx)(n.p,{children:"\u53ea\u6709\u5408\u7ea6\u672c\u8eab\u6216\u5408\u7ea6\u7ba1\u7406\u5458\u53ef\u4ee5\u66f4\u65b0\u5408\u7ea6\u7684\u767d\u540d\u5355\u3002 \u8d5e\u52a9\u8005\u6ca1\u6709\u4fee\u6539\u767d\u540d\u5355\u7684\u6743\u529b\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e00\u4e2a\u5408\u7ea6\u53ef\u4ee5\u8c03\u7528\u51fd\u6570",(0,s.jsx)(n.code,{children:"addPrivilege(address[] memory)"}),"\u5c06\u4efb\u4f55\u5730\u5740\u6dfb\u52a0\u5230\u767d\u540d\u5355\u4e2d\u3002 \u8fd9\u610f\u5473\u7740\u5982\u679c\u8bbe\u7f6e\u4e86",(0,s.jsx)(n.code,{children:"sponsor_for_gas"}),"\uff0c\u5408\u7ea6\u5c06\u4e3a\u767d\u540d\u5355\u4e2d\u7684\u8d26\u6237\u652f\u4ed8gas\u8d39\u7528\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86",(0,s.jsx)(n.code,{children:"sponsor_for_collateral"}),"\uff0c\u5408\u7ea6\u5c06\u4e3a\u767d\u540d\u5355\u4e2d\u7684\u8d26\u6237\u652f\u4ed8CFS\uff08\u5b58\u50a8\u62b5\u62bc\uff09\u3002 \u96f6\u5730\u5740\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u5730\u5740",(0,s.jsx)(n.code,{children:"0x0000000000000000000000000000000000000000"}),"\u3002 \u5982\u679c\u8fd9\u4e2a\u5730\u5740\u88ab\u6dfb\u52a0\u5230\u767d\u540d\u5355\u4e2d\uff0c\u6240\u6709\u8c03\u7528\u8fd9\u4e2a\u5408\u7ea6\u7684\u4ea4\u6613\u90fd\u5c06\u88ab\u8d5e\u52a9\u3002 \u4e00\u4e2a\u5408\u7ea6\u53ef\u4ee5\u8c03\u7528\u51fd\u6570",(0,s.jsx)(n.code,{children:"removePrivilege(address[] memory)"}),"\u4ece\u767d\u540d\u5355\u4e2d\u79fb\u9664\u4e00\u4e9b\u666e\u901a\u8d26\u6237\u5730\u5740\u3002 \u79fb\u9664\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u5730\u5740\u4e0d\u4f1a\u5bfc\u81f4\u9519\u8bef\u6216\u5f02\u5e38\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8fb9\u754c\u60c5\u51b5\uff1a"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u5408\u7ea6\u5730\u5740\u4e5f\u80fd\u88ab\u6dfb\u52a0\u5230\u767d\u540d\u5355\u5217\u8868\u4e2d\uff0c\u4f46\u8fd9\u4e2a\u884c\u4e3a\u6ca1\u6709\u610f\u4e49\u3002\u56e0\u4e3a\u53ea\u6709\u4ea4\u6613\u7684\u53d1\u9001\u8005\u624d\u80fd\u88ab\u8d5e\u52a9\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5408\u7ea6\u7684\u7ba1\u7406\u5458\u53ef\u4ee5\u4f7f\u7528\u63a5\u53e3",(0,s.jsx)(n.code,{children:"addPrivilegeByAdmin(address contractAddr, address[] memory addresses)"}),"\u548c",(0,s.jsx)(n.code,{children:"removePrivilegeByAdmin(address contractAddr, address[] memory addresses)"}),"\u6765\u7ef4\u62a4\u767d\u540d\u5355\u3002"]})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},11151:(e,n,o)=>{o.d(n,{Z:()=>a,a:()=>c});var s=o(67294);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);