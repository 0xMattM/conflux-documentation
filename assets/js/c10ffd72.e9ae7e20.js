"use strict";(self.webpackChunkconflux_docs=self.webpackChunkconflux_docs||[]).push([[6506],{83191:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>d,toc:()=>o});var i=s(85893),t=s(11151);const c={sidebar_position:2,title:"EVM Compatibility",description:"EVM Compatibility of Conflux eSpace",keywords:["EVM","Compatibility"],displayed_sidebar:"eSpaceSidebar"},r=void 0,d={id:"espace/build/evm-compatibility",title:"EVM Compatibility",description:"EVM Compatibility of Conflux eSpace",source:"@site/docs/espace/build/evm-compatibility.md",sourceDirName:"espace/build",slug:"/espace/build/evm-compatibility",permalink:"/docs/espace/build/evm-compatibility",draft:!1,unlisted:!1,editUrl:"https://github.com/Conflux-Chain/conflux-documentation/edit/main/docs/espace/build/evm-compatibility.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"EVM Compatibility",description:"EVM Compatibility of Conflux eSpace",keywords:["EVM","Compatibility"],displayed_sidebar:"eSpaceSidebar"},sidebar:"eSpaceSidebar",previous:{title:"Gnosis Safe Wallet",permalink:"/docs/espace/build/infrastructure/gnosis-safe-wallet"},next:{title:"JSON-RPC Compatibility",permalink:"/docs/espace/build/jsonrpc-compatibility"}},a={},o=[{value:"Transaction Type",id:"transaction-type",level:2},{value:"EVM Opcodes",id:"evm-opcodes",level:2},{value:"Block Time",id:"block-time",level:2},{value:"Contract Size",id:"contract-size",level:2},{value:"Transaction Fees",id:"transaction-fees",level:2},{value:"Transaction Gas limit",id:"transaction-gas-limit",level:2},{value:"EVM Precompiles",id:"evm-precompiles",level:2},{value:"Phantom transactions",id:"phantom-transactions",level:2},{value:"Example",id:"example",level:3},{value:"Resources",id:"resources",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"The eSpace implements an Ethereum Virtual Machine (EVM). Below are some differences between eSpace and Ethereum:"}),"\n",(0,i.jsx)(n.h2,{id:"transaction-type",children:"Transaction Type"}),"\n",(0,i.jsxs)(n.p,{children:["Currently eSpace only support ",(0,i.jsx)(n.strong,{children:"155 type"})," transaction. 1559 type transaction is not support."]}),"\n",(0,i.jsx)(n.h2,{id:"evm-opcodes",children:"EVM Opcodes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"BLOCKHASH"})," opcode can only take ",(0,i.jsx)(n.code,{children:"NUMBER-1"})," as input. (Unlike Ethereum, which takes any integer in ",(0,i.jsx)(n.code,{children:"NUMBER-256"})," to ",(0,i.jsx)(n.code,{children:"NUMBER-1"})," as input). This is the ",(0,i.jsx)(n.strong,{children:"only break opcode"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"block-time",children:"Block Time"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"NUMBER"})," opcode will return the tree-graph ",(0,i.jsx)(n.code,{children:"epoch number"}),". As a result, ",(0,i.jsx)(n.code,{children:"block.number"})," used in eSpace contracts will not grow at a stable and predictable rate, and so it might not be suitable for measuring time."]}),"\n",(0,i.jsx)(n.p,{children:"Block generate rate is 1.25s per block (mainnet), is same as Core Space Epoch time."}),"\n",(0,i.jsx)(n.h2,{id:"contract-size",children:"Contract Size"}),"\n",(0,i.jsxs)(n.p,{children:["Contract max code size is ",(0,i.jsx)(n.code,{children:"49152"})," double as Ethereum"]}),"\n",(0,i.jsx)(n.h2,{id:"transaction-fees",children:"Transaction Fees"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["No gas refund in ",(0,i.jsx)(n.code,{children:"SSTORE"})," opcode and ",(0,i.jsx)(n.code,{children:"SUICIDE"})," opcode."]}),"\n",(0,i.jsxs)(n.li,{children:["The operations which occupy storage have a different gas cost.","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SSTORE"})," costs 40000 gas (instead of 20000 gas in Ethereum) when changing a storage entry from zero to non-zero."]}),"\n",(0,i.jsx)(n.li,{children:"When deploying a new contract, each byte costs 400 gas (instead of 200 gas in Ethereum)."}),"\n",(0,i.jsxs)(n.li,{children:["When creating a new account by ",(0,i.jsx)(n.code,{children:"CALL"})," or ",(0,i.jsx)(n.code,{children:"SUICIDE"}),", it consumes 50000 gas (instead of 25000 gas in Ethereum)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["At most ",(0,i.jsx)(n.code,{children:"1/4"})," of transaction ",(0,i.jsx)(n.code,{children:"gasLimit"})," will be refund (if not used)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"transaction-gas-limit",children:"Transaction Gas limit"}),"\n",(0,i.jsxs)(n.p,{children:["Only the block whose block height is a multiple of ",(0,i.jsx)(n.code,{children:"5"})," can pack Ethereum type transaction. The total gas limit of these transaction cannot exceed half of the block gas limit (15,000,000)."]}),"\n",(0,i.jsx)(n.h2,{id:"evm-precompiles",children:"EVM Precompiles"}),"\n",(0,i.jsx)(n.p,{children:"All standard precompiles are supported."}),"\n",(0,i.jsx)("div",{class:"compat-evm-precompiles-table"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Address"}),(0,i.jsx)(n.th,{children:"ID"}),(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"Spec"}),(0,i.jsx)(n.th,{children:"Status"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x01"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ECRecover"})}),(0,i.jsx)(n.td,{children:"ECDSA public key recovery"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://ethereum.github.io/yellowpaper/paper.pdf",children:"Yellow Paper"})}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x02"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SHA256"})}),(0,i.jsx)(n.td,{children:"SHA-2 256-bit hash function"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://ethereum.github.io/yellowpaper/paper.pdf",children:"Yellow Paper"})}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x03"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RIPEMD160"})}),(0,i.jsx)(n.td,{children:"RIPEMD 160-bit hash function"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://ethereum.github.io/yellowpaper/paper.pdf",children:"Yellow Paper"})}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x04"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Identity"})}),(0,i.jsx)(n.td,{children:"Identity function"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://ethereum.github.io/yellowpaper/paper.pdf",children:"Yellow Paper"})}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x05"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ModExp"})}),(0,i.jsx)(n.td,{children:"Big integer modular exponentiation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-198",children:"EIP-198"})}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x06"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"BN128Add"})}),(0,i.jsx)(n.td,{children:"Elliptic curve addition"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-196",children:"EIP-196"})}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x07"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"BN128Mul"})}),(0,i.jsx)(n.td,{children:"Elliptic curve scalar multiplication"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-196",children:"EIP-196"})}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x08"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"BN128Pair"})}),(0,i.jsx)(n.td,{children:"Elliptic curve pairing check"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-197",children:"EIP-197"})}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0x09"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Blake2F"})}),(0,i.jsxs)(n.td,{children:["BLAKE2b ",(0,i.jsx)(n.code,{children:"F"})," compression function"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-152",children:"EIP-152"})}),(0,i.jsx)(n.td,{children:"\u2705"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"phantom-transactions",children:"Phantom transactions"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.em,{children:"cross-space transaction"})," is a transaction in the Conflux core space that, at some point during its execution, calls one of the state-changing (i.e., not ",(0,i.jsx)(n.code,{children:"view"}),") methods of the ",(0,i.jsx)(n.code,{children:"CrossSpaceCall"})," internal contract.\nSuch transactions can change CFX balances and contract storage in both spaces, core and eSpace."]}),"\n",(0,i.jsxs)(n.p,{children:["As EVM clients are not aware of Conflux space transactions (the two spaces use different transaction formats), we construct one or more ",(0,i.jsx)(n.em,{children:"phantom"})," transactions (aka ",(0,i.jsx)(n.em,{children:"virtual"})," transactions) for each call to the ",(0,i.jsx)(n.code,{children:"CrossSpaceCall"})," internal contract.\nThese phantom transactions are derived from the corresponding core space transaction, they do not exist in the ledger.\nPhantom transactions have the following special properties:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gas"})," and ",(0,i.jsx)(n.code,{children:"gasPrice"})," are ",(0,i.jsx)(n.code,{children:"0"}),". Gas for cross-space transactions is charged in the core space. Therefore, the corresponding phantom transactions do not consume any gas."]}),"\n",(0,i.jsxs)(n.li,{children:["Invalid signature (",(0,i.jsx)(n.code,{children:"r"}),", ",(0,i.jsx)(n.code,{children:"s"}),", ",(0,i.jsx)(n.code,{children:"v"}),", ",(0,i.jsx)(n.code,{children:"standardV"}),"). The Conflux protocol is unable to sign transactions on behalf of the sender of the cross-space transaction. Therefore, phantom transactions use a fake signature that will not pass ECDSA verification."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(n.p,{children:["When we retrieve epoch ",(0,i.jsx)(n.code,{children:"0x72819"})," in the Conflux core space, we see it contains a single Conflux transaction."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'cfx_getBlockByEpochNumber(0x72819, true)\n\n{\n  "epochNumber": "0x72819",\n  "hash": "0x7440c9e8ebb2e87a7d187e4ad6d09027d860b3948cf4364bb883c028b6c3a858",\n  "transactions": [\n    {\n      "hash": "0xe89ef4b61434ec331b621b8687033f9e4058e76759a3522bdc50e0cb358f505e",\n      "blockHash": "0x7440c9e8ebb2e87a7d187e4ad6d09027d860b3948cf4364bb883c028b6c3a858",\n      "from": "NET8888:TYPE.USER:AAJFT5SK5RGK2KTJPMPUEJ69989N15KCCY7JAJEUP2",\n      "to": "NET8888:TYPE.CONTRACT:ACAP3N9KXZ7C4TU5NUU8G65FJ7A09MG1FY77ZAYSVW",\n      "gasPrice": "0x1",\n      "gas": "0x8b28d",\n      "storageLimit": "0x54",\n      "r": "0x2b943e84111cd5f95fbdf15667329ac546c9e5b99548d3c3702aeced4f07de6d",\n      "s": "0x2f47ae3c15ec2d1cbcf5bde3870aa21e1df54e8b7b926840a54faa9951cb3321",\n      "v": "0x0",\n      ...\n    }\n  ],\n  ...\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"When we retrieve the corresponding block in the eSpace, we see it contains two phantom transactions."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'eth_getBlockByNumber(0x72819, true)\n\n{\n  "hash": "0x7440c9e8ebb2e87a7d187e4ad6d09027d860b3948cf4364bb883c028b6c3a858",\n  "number": "0x72819",\n  "transactions": [\n    {\n      "hash": "0xfcdcf304b6b9dc263625b0924efaf3a7eb7044a17d27c0b8d631025b55d1147e",\n      "blockHash": "0x7440c9e8ebb2e87a7d187e4ad6d09027d860b3948cf4364bb883c028b6c3a858",\n      "from": "0x0000000000000000000000000000000000000000",\n      "to": "0xf709629eee416c2d2a53692d38f1568538d8022f",\n      "gasPrice": "0x0",\n      "gas": "0x0",\n      "r": "0x1",\n      "s": "0x1",\n      "v": "0x4593",\n      ...\n    },\n    {\n      "hash": "0xca2f5c5848458bea556f99e626db7108377d600e24add1920c4106358a1a5502",\n      "blockHash": "0x7440c9e8ebb2e87a7d187e4ad6d09027d860b3948cf4364bb883c028b6c3a858",\n      "from": "0xf709629eee416c2d2a53692d38f1568538d8022f",\n      "to": "0xdacf3af269b55ece5fe3239626a27f2a76c48245",\n      "gasPrice": "0x0",\n      "gas": "0x0",\n      "r": "0x1",\n      "s": "0x1",\n      "v": "0x4593",\n      ...\n    }\n  ],\n  ...\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.evm.codes/",children:"EVM opcodes reference"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>d,a:()=>r});var i=s(67294);const t={},c=i.createContext(t);function r(e){const n=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);