"use strict";(self.webpackChunkconflux_docs=self.webpackChunkconflux_docs||[]).push([[1845],{33251:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var t=n(85893),s=n(11151);const o={sidebar_position:1,title:"Node Setup",displayed_sidebar:"eSpaceSidebar"},i=void 0,a={id:"espace/build/infrastructure/graph/setup-graph-node",title:"Node Setup",description:"Graph Node is the component which indexes subgraphs, and makes the resulting data available to query via a GraphQL API. As such it is central to the indexer stack, and correct operation of Graph Node is crucial to running a successful indexer.",source:"@site/docs/espace/build/infrastructure/graph/setup-graph-node.md",sourceDirName:"espace/build/infrastructure/graph",slug:"/espace/build/infrastructure/graph/setup-graph-node",permalink:"/docs/espace/build/infrastructure/graph/setup-graph-node",draft:!1,unlisted:!1,editUrl:"https://github.com/Conflux-Chain/conflux-documentation/edit/main/docs/espace/build/infrastructure/graph/setup-graph-node.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Node Setup",displayed_sidebar:"eSpaceSidebar"},sidebar:"eSpaceSidebar",previous:{title:"The Graph",permalink:"/docs/espace/build/infrastructure/graph/"},next:{title:"Creating Subgraphs",permalink:"/docs/espace/build/infrastructure/graph/create-subgraphs"}},d={},c=[{value:"Graph Node",id:"graph-node",level:2},{value:"PostgreSQL database",id:"postgresql-database",level:3},{value:"Network clients",id:"network-clients",level:3},{value:"IPFS Nodes",id:"ipfs-nodes",level:3},{value:"Getting started from source",id:"getting-started-from-source",level:3},{value:"Install prerequisites",id:"install-prerequisites",level:3},{value:"Setup",id:"setup",level:3},{value:"Getting started using Docker",id:"getting-started-using-docker",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Setup",id:"setup-1",level:3}];function h(e){const r={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"Graph Node is the component which indexes subgraphs, and makes the resulting data available to query via a GraphQL API. As such it is central to the indexer stack, and correct operation of Graph Node is crucial to running a successful indexer."}),"\n",(0,t.jsxs)(r.p,{children:["This provides a contextual overview of Graph Node, and some of the more advanced options available to indexers. Detailed documentation and instructions can be found in the\xa0",(0,t.jsx)(r.a,{href:"https://github.com/graphprotocol/graph-node",children:"Graph Node repository"}),"."]}),"\n",(0,t.jsx)(r.h2,{id:"graph-node",children:"Graph Node"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.a,{href:"https://github.com/graphprotocol/graph-node",children:"Graph Node"}),"\xa0is the reference implementation for indexing Subgraphs on The Graph Network, connecting to blockchain clients, indexing subgraphs and making indexed data available to query."]}),"\n",(0,t.jsxs)(r.p,{children:["Graph Node (and the whole indexer stack) can be run on bare metal, or in a cloud environment. This flexibility of the central indexing component is crucial to the robustness of The Graph Protocol. Similarly, Graph Node can be\xa0",(0,t.jsx)(r.a,{href:"https://github.com/graphprotocol/graph-node",children:"built from source"}),", or indexers can use one of the\xa0",(0,t.jsx)(r.a,{href:"https://hub.docker.com/r/graphprotocol/graph-node",children:"provided Docker Images"}),"."]}),"\n",(0,t.jsx)(r.h3,{id:"postgresql-database",children:"PostgreSQL database"}),"\n",(0,t.jsx)(r.p,{children:"The main store for the Graph Node, this is where subgraph data is stored, as well as metadata about subgraphs, and subgraph-agnostic network data such as the block cache, and eth_call cache."}),"\n",(0,t.jsx)(r.h3,{id:"network-clients",children:"Network clients"}),"\n",(0,t.jsx)(r.p,{children:"In order to index a network, Graph Node needs access to a network client via an EVM-compatible JSON-RPC API. This RPC may connect to a single client or it could be a more complex setup that load balances across multiple."}),"\n",(0,t.jsxs)(r.p,{children:["While some subgraphs may just require a full node, some may have indexing features which require additional RPC functionality. Specifically subgraphs which make\xa0",(0,t.jsx)(r.code,{children:"eth_calls"}),"\xa0as part of indexing will require an archive node which supports\xa0",(0,t.jsx)(r.a,{href:"https://eips.ethereum.org/EIPS/eip-1898",children:"EIP-1898"}),", and subgraphs with\xa0",(0,t.jsx)(r.code,{children:"callHandlers"}),", or\xa0",(0,t.jsx)(r.code,{children:"blockHandlers"}),"\xa0with a\xa0",(0,t.jsx)(r.code,{children:"call"}),"\xa0filter, require\xa0",(0,t.jsx)(r.code,{children:"trace_filter"}),"\xa0support (",(0,t.jsx)(r.a,{href:"https://openethereum.github.io/JSONRPC-trace-module",children:"see trace module documentation here"}),")."]}),"\n",(0,t.jsx)(r.h3,{id:"ipfs-nodes",children:"IPFS Nodes"}),"\n",(0,t.jsxs)(r.p,{children:["Subgraph deployment metadata is stored on the IPFS network. The Graph Node primarily accesses the IPFS node during subgraph deployment to fetch the subgraph manifest and all linked files. Network indexers do not need to host their own IPFS node. An IPFS node for the network is hosted at\xa0",(0,t.jsx)(r.a,{href:"https://ipfs.network.thegraph.com/",children:"https://ipfs.network.thegraph.com"}),"."]}),"\n",(0,t.jsx)(r.h3,{id:"getting-started-from-source",children:"Getting started from source"}),"\n",(0,t.jsx)(r.h3,{id:"install-prerequisites",children:"Install prerequisites"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Rust"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"PostgreSQL"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"IPFS"})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Additional Requirements for Ubuntu users"}),"\xa0- To run a Graph Node on Ubuntu a few additional packages may be needed."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"sudo apt-get install -y clang libpg-dev libssl-dev pkg-config"})}),"\n",(0,t.jsx)(r.h3,{id:"setup",children:"Setup"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Start a PostgreSQL database server"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"initdb -D .postgres pg_ctl -D .postgres -l logfile start createdb graph-node"})}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:["Clone\xa0",(0,t.jsx)(r.a,{href:"https://github.com/graphprotocol/graph-node",children:"Graph Node"}),"\xa0repo and build the source by running\xa0",(0,t.jsx)(r.code,{children:"cargo build"})]}),"\n",(0,t.jsx)(r.li,{children:"Now that all the dependencies are setup, start the Graph Node:"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"cargo run -p graph-node --release -- \\   --postgres-url postgresql://[USERNAME]:[PASSWORD]@localhost:5432/graph-node \\   --ethereum-rpc [NETWORK_NAME]:[URL] \\   --ipfs https://ipfs.network.thegraph.com"})}),"\n",(0,t.jsx)(r.h3,{id:"getting-started-using-docker",children:"Getting started using Docker"}),"\n",(0,t.jsx)(r.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Ethereum node"}),"\xa0- By default, the docker compose setup will use mainnet:\xa0",(0,t.jsx)(r.a,{href:"http://host.docker.internal:8545/",children:"http://host.docker.internal:8545"}),"\xa0to connect to the Ethereum node on your host machine. You can replace this network name and url by updating\xa0",(0,t.jsx)(r.code,{children:"docker-compose.yml"}),"."]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"setup-1",children:"Setup"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Clone Graph Node and navigate to the Docker directory:"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"git clone http://github.com/graphprotocol/graph-node cd graph-node/docker"})}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:["For linux users only - Use the host IP address instead of\xa0",(0,t.jsx)(r.code,{children:"host.docker.internal"}),"\xa0in the\xa0",(0,t.jsx)(r.code,{children:"docker-compose.yml"}),"using the included script:"]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"./setup.sh"})}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Start a local Graph Node that will connect to your Ethereum endpoint:"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"docker-compose up"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.em,{children:(0,t.jsx)(r.strong,{children:"References"})})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"https://thegraph.com/docs/en/operating-graph-node/",children:"https://thegraph.com/docs/en/operating-graph-node/"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"https://hub.docker.com/r/graphprotocol/graph-node/",children:"https://hub.docker.com/r/graphprotocol/graph-node/"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"https://github.com/pranavdaa/Graph-Node-Local",children:"https://github.com/pranavdaa/Graph-Node-Local"})})]})}function l(e={}){const{wrapper:r}={...(0,s.a)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},11151:(e,r,n)=>{n.d(r,{Z:()=>a,a:()=>i});var t=n(67294);const s={},o=t.createContext(s);function i(e){const r=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);