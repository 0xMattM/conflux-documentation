"use strict";(self.webpackChunkconflux_docs=self.webpackChunkconflux_docs||[]).push([[7520],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),s=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=s(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),c=s(a),h=r,m=c["".concat(l,".").concat(h)]||c[h]||d[h]||i;return a?n.createElement(m,o(o({ref:t},u),{},{components:a})):n.createElement(m,o({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=h;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[c]="string"==typeof e?e:r,o[1]=p;for(var s=2;s<i;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},32662:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>p,toc:()=>s});var n=a(87462),r=(a(67294),a(3905));const i={sidebar_position:2,title:"Creating Subgraphs",displayed_sidebar:"eSpaceSidebar"},o=void 0,p={unversionedId:"espace/build/infrastructure/graph/create-subgraphs",id:"espace/build/infrastructure/graph/create-subgraphs",title:"Creating Subgraphs",description:"A subgraph extracts data from a blockchain, processing it and storing it so that it can be easily queried via GraphQL.",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/espace/build/infrastructure/graph/create-subgraphs.md",sourceDirName:"espace/build/infrastructure/graph",slug:"/espace/build/infrastructure/graph/create-subgraphs",permalink:"/es/docs/espace/build/infrastructure/graph/create-subgraphs",draft:!1,editUrl:"https://crowdin.com/project/conflux/es",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Creating Subgraphs",displayed_sidebar:"eSpaceSidebar"},sidebar:"eSpaceSidebar",previous:{title:"Node Setup",permalink:"/es/docs/espace/build/infrastructure/graph/setup-graph-node"},next:{title:"ConfluxScan API",permalink:"/es/docs/espace/build/infrastructure/confluxscan-api"}},l={},s=[{value:"Install the Graph CLI",id:"install-the-graph-cli",level:2},{value:"From An Existing Contract",id:"from-an-existing-contract",level:2},{value:"From An Example Subgraph",id:"from-an-example-subgraph",level:2},{value:"Add New dataSources To An Existing Subgraph",id:"add-new-datasources-to-an-existing-subgraph",level:2}],u={toc:s},c="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(c,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"A subgraph extracts data from a blockchain, processing it and storing it so that it can be easily queried via GraphQL."),(0,r.kt)("p",null,"The subgraph definition consists of a few files:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"subgraph.yaml"),": a YAML file containing the subgraph manifest"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"schema.graphql"),": a GraphQL schema that defines what data is stored for your subgraph, and how to query it via GraphQL"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"AssemblyScript Mappings"),":\xa0",(0,r.kt)("a",{parentName:"li",href:"https://github.com/AssemblyScript/assemblyscript"},"AssemblyScript"),"\xa0code that translates from the event data to the entities defined in your schema (e.g.\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"mapping.ts"),"\xa0in this tutorial)")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"In order to use your subgraph on The Graph's decentralized network, you will need to\xa0create an API key. It is recommended that you\xa0add signal\xa0to your subgraph with at least\xa010,000 GRT.")),(0,r.kt)("p",null,"Before you go into detail about the contents of the manifest file, you need to install the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/graphprotocol/graph-cli"},"Graph CLI"),"\xa0which you will need to build and deploy a subgraph."),(0,r.kt)("h2",{id:"install-the-graph-cli"},"Install the Graph CLI"),(0,r.kt)("p",null,"The Graph CLI is written in JavaScript, and you will need to install either\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"yarn"),"\xa0or\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"npm"),"\xa0to use it; it is assumed that you have yarn in what follows."),(0,r.kt)("p",null,"Once you have\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"yarn"),", install the Graph CLI by running"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Install with yarn:")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"yarn global add @graphprotocol/graph-cli")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Install with npm:")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"npm install -g @graphprotocol/graph-cli")),(0,r.kt)("p",null,"Once installed, the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"graph init"),"\xa0command can be used to set up a new subgraph project, either from an existing contract or from an example subgraph. This command can be used to create a subgraph on the Subgraph Studio by passing in\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"graph init --product subgraph-studio"),". If you already have a smart contract deployed to your preferred network, bootstrapping a new subgraph from that contract can be a good way to get started."),(0,r.kt)("h2",{id:"from-an-existing-contract"},"From An Existing Contract"),(0,r.kt)("p",null,"The following command creates a subgraph that indexes all events of an existing contract. It attempts to fetch the contract ABI from Etherscan and falls back to requesting a local file path. If any of the optional arguments are missing, it takes you through an interactive form."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"graph init \\\n  --product subgraph-studio\n  --from-contract <CONTRACT_ADDRESS> \\\n  [--network <ETHEREUM_NETWORK>] \\\n  [--abi <FILE>] \\\n  <SUBGRAPH_SLUG> [<DIRECTORY>]\n")),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"<SUBGRAPH_SLUG>"),"\xa0is the ID of your subgraph in Subgraph Studio, it can be found on your subgraph details page."),(0,r.kt)("h2",{id:"from-an-example-subgraph"},"From An Example Subgraph"),(0,r.kt)("p",null,"The second mode\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"graph init"),"\xa0supports is creating a new project from an example subgraph. The following command does this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"graph init --studio <SUBGRAPH_SLUG>\n")),(0,r.kt)("p",null,"The example subgraph is based on the Gravity contract by Dani Grant that manages user avatars and emits\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"NewGravatar"),"\xa0or\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"UpdateGravatar"),"\xa0events whenever avatars are created or updated. The subgraph handles these events by writing\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Gravatar"),"\xa0entities to the Graph Node store and ensuring these are updated according to the events. The following sections will go over the files that make up the subgraph manifest for this example."),(0,r.kt)("h2",{id:"add-new-datasources-to-an-existing-subgraph"},"Add New dataSources To An Existing Subgraph"),(0,r.kt)("p",null,"Since\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"v0.31.0"),"\xa0the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"graph-cli"),"\xa0supports adding new dataSources to an existing subgraph through the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"graph add"),"\xa0command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'graph add <address> [<subgraph-manifest default: "./subgraph.yaml">]\n\nOptions:\n\n      --abi <path>              Path to the contract ABI (default: download from Etherscan)\n      --contract-name           Name of the contract (default: Contract)\n      --merge-entities          Whether to merge entities with the same name (default: false)\n      --network-file <path>     Networks config file path (default: "./networks.json")\n')),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"add"),"\xa0command will fetch the ABI from Etherscan (unless an ABI path is specified with the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"--abi"),"\xa0option), and will create a new\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"dataSource"),"\xa0in the same way that\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"graph init"),"\xa0command creates a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"dataSource"),"\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"--from-contract"),", updating the schema and mappings accordingly."),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"--merge-entities"),"\xa0option identifies how the developer would like to handle\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"entity"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"event"),"\xa0name conflicts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"true"),": the new\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"dataSource"),"\xa0should use existing\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"eventHandlers"),"\xa0&\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"entities"),"."),(0,r.kt)("li",{parentName:"ul"},"If\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"false"),": a new entity & event handler should be created with\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"${dataSourceName}{EventName}"),".")),(0,r.kt)("p",null,"The contract\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"address"),"\xa0will be written to the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"networks.json"),"\xa0for the relevant network."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note:\xa0When using the interactive cli, after successfully running\xa0graph init, you'll be prompted to add a new\xa0dataSource.")))}d.isMDXComponent=!0}}]);